ron-iam
---

参考：https://time.geekbang.org/column/intro/100079601

https://github.com/marmotedu/iam



## 1 概述



Go 应用的安全大体上分为2类：

- **服务自身的安全**：为了保证服务的安全，需要禁止非法用户访问服务。这可以通过服务器层面和软件层面来解决。

  **服务器层面**可以通过**物理隔离、网络隔离、防火墙**等技术从底层保证服务的安全性，

  **软件层面**可以通过**HTTPS、用户认证**等手段来加强服务的安全性。

  服务器层面一般由运维团队来保障，软件层面则需要开发者来保障。

- 服务资源的安全：服务内有很多资源，为了避免非法访问，开发者要避免 UserA 访问到 UserB 的资源，也即需要对资源进行授权。通常，可以通过**资源授权系统**来对资源进行授权。

对访问进行认证，对资源进行授权。

将认证和授权的功能实现升级为IAM系统。

### 1.1 IAM系统是什么？

IAM（Identity and Access Management，身份识别与访问管理）系统是用 Go 语言编写的一个 Web 服务，用于给第三方用户提供访问控制服务。

解决的问题是：**在特定的条件下，谁能够/不能够对哪些资源做哪些操作**（Who is able to do what on something given some context），也即完成资源授权功能。

![](images/image-20240714001854603.png)

1.  用户需要提供昵称、密码、邮箱、电话等信息注册并登录到IAM系统，这里是以用户名和密码作为唯一的身份标识来访问 IAM 系统，并且完成**认证**。
2.  因为访问IAM的资源授权接口是通过密钥（secretID/secretKey）的方式进行认证的，所以用户需要 IAM中创建属于自己的密钥资源。
3.  因为IAM通过授权策略完成授权，所以用户需要在IAM中创建**授权策略**。
4.  请求IAM提供的授权接口，IAM会根据用户的**请求内容和授权策略**来决定一个授权请求是否被允许。

在上面的流程中，IAM使用到了3种系统资源：用户（User）、密钥（Secret）和策略（Policy），映射到程序设计中就是3种RESTful资源：
•  ==用户（User）==：实现对用户的增、删、改、查、修改密码、批量修改等操作。
•  ==密钥（Secret）==：实现对密钥的增、删、改、查操作。
•  ==策略（Policy）==：实现对策略的增、删、改、查、批量删除操作。

### 1.2 IAM系统的架构

![](images/image-20240714002402893.png)

9大组件和3大数据库（Redis、MySQL和MongoDB）

![](images/image-20240714002555530.png)

![](images/image-20240714002618073.png)

#### 1️⃣通过使用流程理解架构

1. 创建平台资源。



2. 请求 API 完成资源授权。



3. 授权日志数据分析。



4. 运营平台授权数据展示。





#### 2️⃣IAM软件架构模式

2种最常用的软件架构模式

##### 前后端分离架构

一般来说，运营系统的功能可多可少，对于一些具有复杂功能的运营系统，我们可以采用前后端分离的架构。其中，**前端负责页面的展示以及数据的加载和渲染，后端只负责返回前端需要的数据。**

IAM的运营系统 iam-operating-system

![](images/image-20240714003504732.png)

##### MVC架构

如果运营系统功能比较少，采用前后端分离框架的弊反而大于利，比如前后端分离要同时维护 2 个组件会导致部署更复杂，并且前后端分离将人员也分开了，这会增加一定程度的沟通成本。同时，因为代码中也需要实现前后端交互的逻辑，所以会引入一定的开发量。

![](images/image-20240714003714458.png)







# 一、规范设计

4 规范设计（上）：项目开发杂乱无章，如何规范？

5 规范设计（下）：commit 信息风格迥异、难以阅读，如何规范？

6 目录结构设计：如何组织一个可维护、可扩展的代码目录？

7 工作流设计：如何设计合理的多人开发模式？

8 研发流程设计（上）：如何设计 Go 项目的开发流程？

9 研发流程设计（下）：如何管理应用的生命周期？

10 设计方法：怎么写出优雅的 Go 项目？

11 设计模式：Go常用设计模式概述

# 二、基础功能设计或开发

12 API 风格（上）：如何设计RESTful API？

13 API 风格（下）：RPC API介绍

14 项目管理：如何编写高质量的Makefile？

15 研发流程实战：IAM项目是如何进行研发流程管理的？

16 代码检查：如何进行静态代码检查？

17 API 文档：如何生成 Swagger API 文档 ？

18 错误处理（上）：如何设计一套科学的错误码？

19 错误处理（下）：如何设计错误包？

20 日志处理（上）：如何设计日志包并记录日志？

21 日志处理（下）：手把手教你从 0 编写一个日志包

22 应用构建三剑客：Pflag、Viper、Cobra 核心功能介绍

23 应用构建实战：如何构建一个优秀的企业应用框架？



# 三、服务开发

24 Web 服务：Web 服务核心功能有哪些，如何实现？

25 认证机制：应用程序如何进行访问认证？

26 IAM项目是如何设计和实现访问认证功能的？

27 权限模型：5大权限模型是如何进行资源授权的？

28 控制流（上）：通过iam-apiserver设计，看Web服务的构建

29 控制流（下）：iam-apiserver服务核心功能实现讲解


30 ORM：CURD 神器 GORM 包介绍及实战

31 数据流：通过iam-authz-server设计，看数据流服务的设计

32 数据处理：如何高效处理应用程序产生的数据？

33 SDK 设计（上）：如何设计出一个优秀的 Go SDK？

34 SDK 设计（下）：IAM项目Go SDK设计和实现

35 效率神器：如何设计和实现一个命令行客户端工具？



# 四、服务测试

36 代码测试（上）：如何编写 Go 语言单元测试和性能测试用例？

37 代码测试（下）：Go 语言其他测试类型及 IAM 测试介绍

38 性能分析（上）：如何分析 Go 语言代码的性能？

39 性能分析（下）：API Server性能测试和调优实战

# 五、服务部署

40 软件部署实战（上）：部署方案及负载均衡、高可用组件介绍

41 软件部署实战（中）：IAM 系统生产环境部署实战

42 软件部署实战（下）：IAM系统安全加固、水平扩缩容实战

43 技术演进（上）：虚拟化技术演进之路

44 技术演进（下）：软件架构和应用生命周期技术演进之路

45 基于Kubernetes的云原生架构设计

46 如何制作Docker镜像？

47 如何编写Kubernetes资源定义文件？

48 IAM 容器化部署实战

49 服务编排（上）：Helm服务编排基础知识

50 服务编排（下）：基于Helm的服务编排部署实战

51 基于 GitHub Actions 的 CI 实战